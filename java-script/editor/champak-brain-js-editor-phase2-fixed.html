<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Champak Brain ‚Äî JavaScript Editor (Phase 2)</title>

    <style>
      :root {
        --bg: #fff7e6;
        --card: #ffffff;
        --ink: #1f2937;
        --muted: #6b7280;
        --brand: #d97706;
        --brand2: #f59e0b;
        --border: #eadcc5;
        --shadow: 0 18px 40px rgba(31, 41, 55, 0.14);
        --codebg: #0b1220;
        --codeink: #e5e7eb;
        --ok: #166534;
        --bad: #b91c1c;
        --r: 18px;
        --mono: ui-monospace, Menlo, Consolas, monospace;
      }
      body {
        margin: 0;
        font-family: system-ui;
        background: linear-gradient(180deg, var(--bg), #fff);
      }
      * {
        box-sizing: border-box;
      }
      .wrap {
        max-width: 1300px;
        margin: 16px auto;
        padding: 14px;
      }
      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--r);
        box-shadow: var(--shadow);
      }
      .top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        margin-bottom: 12px;
      }
      h1 {
        margin: 0;
        font-size: 18px;
      }
      .btn {
        border: 1px solid var(--border);
        background: #fff;
        border-radius: 14px;
        padding: 8px 12px;
        font-weight: 800;
        cursor: pointer;
      }
      .btn.primary {
        background: linear-gradient(180deg, var(--brand2), var(--brand));
        border: 0;
      }
      .grid {
        display: grid;
        grid-template-columns: 1.3fr 0.7fr;
        gap: 12px;
      }
      @media (max-width: 900px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }
      .tabs {
        display: flex;
        gap: 8px;
        padding: 8px;
        border-bottom: 1px solid var(--border);
      }
      .tab {
        padding: 6px 12px;
        border-radius: 999px;
        border: 1px solid var(--border);
        cursor: pointer;
        font-weight: 800;
      }
      .tab.active {
        background: linear-gradient(180deg, var(--brand2), var(--brand));
        border: 0;
      }
      .editor {
        background: var(--codebg);
        color: var(--codeink);
        font-family: var(--mono);
        min-height: 420px;
        white-space: pre;
        outline: none;
        padding: 12px;
        border-radius: 14px;
      }
      .out {
        background: #020617;
        color: #e5e7eb;
        font-family: var(--mono);
        min-height: 220px;
        padding: 12px;
        border-radius: 14px;
        white-space: pre-wrap;
      }
      .err {
        color: #fecaca;
      }
      .ok {
        color: #bbf7d0;
      }
      .small {
        font-size: 12px;
        color: var(--muted);
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <div class="top">
        <h1>üß† Champak Brain ‚Äî JavaScript Editor (Phase 2)</h1>
        <div>
          <button class="btn primary" id="run">‚ñ∂ Run</button>
          <button class="btn" id="stop">‚õî Stop</button>
          <button class="btn" id="share">üîó Share</button>
          <button class="btn" id="download">‚¨á App</button>
        </div>
      </div>

      <div class="grid">
        <div class="card">
          <div id="editor" class="editor" contenteditable="true">
            function sum(n){ let s=0; for(let i=1;i<=n;i++) s+=i; return s; }
            console.log(sum(5));
          </div>
        </div>

        <div class="card" style="padding: 12px">
          <b>Problem Mode</b><br />
          <select id="problem"></select>
          <button class="btn" id="loadStarter">‚ö° Starter</button>
          <button class="btn" id="runTests">üèÅ Run Tests</button>
          <div class="out" id="out"></div>
          <div id="judge"></div>
        </div>
      </div>
    </div>

    <script>
      const PROBLEMS = [
        {
          id: "sum",
          title: "Sum N",
          starter: "function solve(n){\n}\nconsole.log(solve(5));",
          tests: [
            { input: 5, output: 15 },
            { input: 10, output: 55 },
            { input: 0, output: 0, hidden: true },
          ],
        },
      ];

      const editor = document.getElementById("editor");
      const out = document.getElementById("out");
      const judge = document.getElementById("judge");
      const probSel = document.getElementById("problem");
      PROBLEMS.forEach((p) => {
        const o = document.createElement("option");
        o.value = p.id;
        o.textContent = p.title;
        probSel.appendChild(o);
      });

      let worker = null;

      function runJS(code, timeout = 2000) {
        return new Promise((res, rej) => {
          const blob = new Blob(
            [
              `
      let log=[];
      console.log=(...a)=>log.push(a.join(" "));
      onmessage=e=>{
        try{eval(e.data);postMessage({ok:true,log});}
        catch(err){postMessage({ok:false,error:err.message,log});}
      };
    `,
            ],
            { type: "application/javascript" }
          );
          const url = URL.createObjectURL(blob);
          worker = new Worker(url);
          const t = setTimeout(() => {
            worker.terminate();
            rej("Timeout");
          }, timeout);
          worker.onmessage = (e) => {
            clearTimeout(t);
            res(e.data);
            worker.terminate();
          };
          worker.postMessage(code);
        });
      }

      document.getElementById("run").onclick = async () => {
        out.textContent = "";
        try {
          const r = await runJS(editor.innerText);
          r.log.forEach((l) => (out.textContent += l + "\n"));
          out.textContent += "‚úì Done";
        } catch (e) {
          out.textContent = e;
        }
      };

      document.getElementById("stop").onclick = () => {
        if (worker) worker.terminate();
      };

      document.getElementById("loadStarter").onclick = () => {
        const p = PROBLEMS[0];
        editor.innerText = p.starter;
      };

      document.getElementById("runTests").onclick = async () => {
        judge.innerHTML = "";
        let pass = 0;
        for (const t of PROBLEMS[0].tests) {
          try {
            const r = await runJS(
              editor.innerText.replace(/console.log\(.*\)/, "") +
                "\nconsole.log(solve(" +
                t.input +
                "))"
            );
            const ok = Number(r.log.join("")) === t.output;
            if (ok) pass++;
            judge.innerHTML += ok
              ? "<div class=pass>PASS</div>"
              : "<div class=fail>FAIL</div>";
          } catch (e) {
            judge.innerHTML += "<div class=fail>ERROR</div>";
          }
        }
        judge.innerHTML += `<b>Score ${pass}/${PROBLEMS[0].tests.length}</b>`;
      };

      document.getElementById("share").onclick = () => {
        window.open(
          "https://wa.me/?text=" +
            encodeURIComponent("Champak Brain JS Editor " + location.href)
        );
      };

      document.getElementById("download").onclick = () => {
        const blob = new Blob([document.documentElement.outerHTML], {
          type: "text/html",
        });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "champak-brain-js-editor-phase2.html";
        a.click();
      };
    </script>
  </body>
</html>
