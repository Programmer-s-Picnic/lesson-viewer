<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Programmerâ€™s Picnic â€” Practice Trading Lab</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body{
    font-family: system-ui, Segoe UI, Roboto, Arial;
    background:#fffaf2;
    margin:0;
    padding:20px;
    color:#1f2937;
  }
  .card{
    max-width:900px;
    margin:auto;
    background:#ffffff;
    border-radius:16px;
    padding:20px;
    box-shadow:0 10px 25px rgba(0,0,0,.08);
  }
  h1{color:#92400e}
  input,button{
    padding:10px 14px;
    font-size:16px;
    border-radius:10px;
    border:1px solid #e5e7eb;
  }
  button{
    background:#f59e0b;
    border:none;
    cursor:pointer;
    color:#fff;
    font-weight:600;
  }
  button:hover{opacity:.9}
  pre{
    background:#111827;
    color:#e5e7eb;
    padding:14px;
    border-radius:10px;
    overflow:auto;
    max-height:280px;
  }
  .note{
    font-size:14px;
    color:#6b7280;
    margin-top:10px;
  }
</style>

<script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
</head>

<body>

<div class="card">
  <h1>ðŸ“ˆ Practice Share Trading (Paper Mode)</h1>

  <p>Enter NSE symbol (example: <b>TCS</b>, <b>INFY</b>, <b>RELIANCE</b>)</p>

  <input id="symbol" placeholder="TCS" />
  <button onclick="loadStock()">Load Data</button>

  <div class="note">
    Uses Yahoo Finance historical CSV (no Selenium, browser-safe)
  </div>

  <h3>ðŸ“Š Output</h3>
  <pre id="output">Waiting...</pre>
</div>

<script>
let pyodideReady = false;
let pyodide;

async function initPyodide(){
  pyodide = await loadPyodide();
  await pyodide.loadPackage(["pandas"]);
  pyodideReady = true;
}
initPyodide();

async function loadStock(){
  const symbol = document.getElementById("symbol").value.trim().toUpperCase();
  if(!symbol) return;

  const out = document.getElementById("output");
  out.textContent = "Downloading data...";

  const period1 = 1609459200; // Jan 1, 2021
  const period2 = Math.floor(Date.now()/1000);

  const url =
    `https://query1.finance.yahoo.com/v7/finance/download/${symbol}.NS?period1=${period1}&period2=${period2}&interval=1d&events=history`;

  const res = await fetch(url);
  const csv = await res.text();

  pyodide.globals.set("csv_data", csv);

  const result = await pyodide.runPythonAsync(`
import pandas as pd
from io import StringIO

df = pd.read_csv(StringIO(csv_data))

last = df.iloc[-1]
summary = {
  "rows": len(df),
  "last_date": str(last["Date"]),
  "close": float(last["Close"]),
  "high": float(last["High"]),
  "low": float(last["Low"])
}

summary
`);

  out.textContent = JSON.stringify(result, null, 2);
}
</script>

</body>
</html>