<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Programmer‚Äôs Picnic ‚Äî Recursion Visualizer</title>

<style>
:root{
  --bg:#fffaf2;
  --card:#ffffff;
  --ink:#1f2937;
  --muted:#6b7280;
  --brand:#d97706;
  --brand2:#f59e0b;
  --border:#e5e7eb;
  --ok:#059669;
  --shadow:0 12px 30px rgba(0,0,0,.08);
  --r:18px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg);
  color:var(--ink);
}
header{
  padding:16px;
  background:#fff;
  border-bottom:1px solid var(--border);
  position:sticky;
  top:0;
  z-index:10;
}
.wrap{max-width:1100px;margin:auto;padding:0 12px}
.badge{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 12px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#fff;
  font-weight:800;
}
.dot{
  width:10px;height:10px;border-radius:50%;
  background:linear-gradient(135deg,var(--brand),var(--brand2))
}
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:14px;
  margin-top:14px
}
@media(max-width:900px){
  .grid{grid-template-columns:1fr}
}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--r);
  box-shadow:var(--shadow);
}
.card h2{
  margin:0;
  padding:14px;
  border-bottom:1px solid var(--border);
  background:#fff7ed;
}
.pad{padding:14px}
label{font-size:12px;color:var(--muted)}
input,select,button{
  width:100%;
  padding:10px;
  border-radius:12px;
  border:1px solid var(--border);
  font-size:14px;
}
.row{display:flex;gap:10px;margin-top:10px}
button{cursor:pointer;font-weight:800;background:#fff}
.primary{background:#fff7ed;border-color:var(--brand)}

.stack{
  display:flex;
  flex-direction:column-reverse;
  gap:10px;
  min-height:260px;
}
.frame{
  background:#fff;
  border-left:6px solid var(--brand);
  padding:10px;
  border-radius:12px;
  box-shadow:0 6px 14px rgba(0,0,0,.06);
}
.frame.active{border-left-color:var(--ok)}
.tag{float:right;font-size:11px;font-weight:800}

.tree-scroll{
  max-height:420px;
  overflow:auto;
  border:1px solid var(--border);
  border-radius:12px;
  background:#fff;
  margin-bottom:12px;
}
.tree-scroll svg{
  min-width:900px;
  min-height:600px;
}
.node rect{rx:10;fill:#fff;stroke:#999}
.node.active rect{stroke:var(--ok);stroke-width:3}
.edge{stroke:#999}

.log{
  background:#0b1020;
  color:#d1d5db;
  padding:10px;
  border-radius:12px;
  max-height:200px;
  overflow:auto;
  font-family:monospace;
}
.ok{color:#34d399}
.dim{color:#94a3b8}

/* ---------- HELP MODAL ---------- */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:50;
}
.modal.open{display:flex}
.modal-card{
  background:#fff;
  max-width:600px;
  width:90%;
  border-radius:18px;
  box-shadow:var(--shadow);
  animation:pop .2s ease;
}
@keyframes pop{
  from{transform:scale(.95);opacity:.5}
  to{transform:scale(1);opacity:1}
}
.modal-header{
  padding:14px;
  background:#fff7ed;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.modal-body{
  padding:16px;
  max-height:60vh;
  overflow:auto;
}
.modal-body h4{margin-top:12px}
.close-btn{
  border:none;
  background:none;
  font-size:20px;
  cursor:pointer;
  font-weight:800;
}
.help-btn{
  border:1px dashed var(--brand);
}
</style>
</head>

<body>

<header>
  <div class="wrap">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div class="badge"><span class="dot"></span> Programmer‚Äôs Picnic</div>
      <div class="badge">Champak Roy</div>
    </div>
    <h1 style="margin:8px 0 0">Recursion Visualizer</h1>
    <p class="dim">Call Stack + Recursion Tree (baby steps)</p>
  </div>
</header>

<main class="wrap">
<div class="grid">

<section class="card">
<h2>Controls</h2>
<div class="pad">

<label>Example</label>
<select id="example">
  <option value="fact">Factorial</option>
  <option value="sum">Sum to N</option>
  <option value="fib">Fibonacci</option>
</select>

<label style="margin-top:10px">n</label>
<input id="n" type="number" value="5" min="0" max="10" />

<div class="row">
  <button class="primary" id="build">Build</button>
  <button id="play">Play</button>
  <button id="step">Step</button>
  <button id="reset">Reset</button>
</div>

<div class="row">
  <button class="help-btn" id="helpBtn">Help ‚ùì</button>
</div>

<p id="status" class="dim">Status: idle</p>
</div>
</section>

<section class="card">
<h2>Visualization</h2>
<div class="pad">

<h4>Recursion Tree</h4>
<div class="tree-scroll">
  <svg id="tree"></svg>
</div>

<h4>Call Stack</h4>
<div class="stack" id="stack"></div>

<h4>Trace</h4>
<div class="log" id="log"></div>

</div>
</section>

</div>
</main>

<!-- HELP MODAL -->
<div class="modal" id="helpModal">
  <div class="modal-card">
    <div class="modal-header">
      <strong>How to Use This Tool</strong>
      <button class="close-btn" onclick="closeHelp()">√ó</button>
    </div>
    <div class="modal-body">
      <p>This visualizer helps you <b>see recursion in action</b>.</p>

      <h4>1Ô∏è‚É£ Build</h4>
      <p>Creates the recursion tree and prepares all calls.</p>

      <h4>2Ô∏è‚É£ Play</h4>
      <p>Runs recursion automatically from start to finish.</p>

      <h4>3Ô∏è‚É£ Step ‚≠ê</h4>
      <p>Executes <b>one call or return at a time</b>. Best for learning.</p>

      <h4>üå≥ Recursion Tree</h4>
      <p>Shows which function calls which. Highlighted node = active call.</p>

      <h4>üìö Call Stack</h4>
      <p>Shows how functions are stacked in memory.</p>

      <h4>üßæ Trace</h4>
      <p>Text log of calls (‚Üí) and returns (‚Üê).</p>

      <hr>
      <p><i>Tip:</i> Start with <b>Factorial, n = 4</b> and use <b>Step</b>.</p>

      <p><b>Recursion is just a function trusting itself.</b></p>
    </div>
  </div>
</div>

<script>
const $ = id => document.getElementById(id);
const sleep = ms => new Promise(r => setTimeout(r, ms));

let steps=[], idx=0, playing=false;
let nodes={}, edges=[], stack=[];
let nodeId=0;

function log(msg, cls="dim"){
  const d=document.createElement("div");
  d.className=cls;
  d.textContent=msg;
  $("log").appendChild(d);
  $("log").scrollTop=9999;
}

function resetAll(){
  steps=[]; idx=0; playing=false;
  nodes={}; edges=[]; stack=[];
  nodeId=0;
  $("tree").innerHTML="";
  $("stack").innerHTML="";
  $("log").innerHTML="";
  $("status").textContent="Status: reset";
}

function node(label,parent=null){
  nodes[++nodeId]={id:nodeId,label,parent,x:0,y:0};
  if(parent) edges.push({from:parent,to:nodeId});
  return nodeId;
}

function build(){
  resetAll();
  const n=+$("n").value;
  const ex=$("example").value;

  if(ex==="fact"){
    (function f(k,parent=null){
      const me=node(`fact(${k})`,parent);
      steps.push({t:"call",id:me});
      if(k===0){
        steps.push({t:"return",id:me,v:1});
        return 1;
      }
      const r=k*f(k-1,me);
      steps.push({t:"return",id:me,v:r});
      return r;
    })(n);
  }

  if(ex==="sum"){
    (function s(k,parent=null){
      const me=node(`sum(${k})`,parent);
      steps.push({t:"call",id:me});
      if(k===0){
        steps.push({t:"return",id:me,v:0});
        return 0;
      }
      const r=k+s(k-1,me);
      steps.push({t:"return",id:me,v:r});
      return r;
    })(n);
  }

  if(ex==="fib"){
    (function f(k,parent=null){
      const me=node(`fib(${k})`,parent);
      steps.push({t:"call",id:me});
      if(k<=1){
        steps.push({t:"return",id:me,v:k});
        return k;
      }
      const r=f(k-1,me)+f(k-2,me);
      steps.push({t:"return",id:me,v:r});
      return r;
    })(n);
  }

  layoutTree();
  drawTree();
  $("status").textContent="Status: built";
}

function layoutTree(){
  let levels={};
  Object.values(nodes).forEach(n=>{
    let d=0,p=n.parent;
    while(p){d++;p=nodes[p].parent}
    (levels[d] ||= []).push(n);
  });
  Object.entries(levels).forEach(([d,arr])=>{
    arr.forEach((n,i)=>{
      n.x=120+i*140;
      n.y=60+d*90;
    });
  });
}

function drawTree(){
  const svg=$("tree");
  svg.innerHTML="";
  edges.forEach(e=>{
    const a=nodes[e.from],b=nodes[e.to];
    svg.innerHTML+=`<line class="edge" x1="${a.x}" y1="${a.y+20}" x2="${b.x}" y2="${b.y-20}"/>`;
  });
  Object.values(nodes).forEach(n=>{
    svg.innerHTML+=`
      <g class="node" id="node-${n.id}">
        <rect x="${n.x-45}" y="${n.y-20}" width="90" height="40"></rect>
        <text x="${n.x}" y="${n.y+5}" text-anchor="middle" font-size="12">${n.label}</text>
      </g>`;
  });
}

function drawStack(active){
  $("stack").innerHTML="";
  stack.forEach(id=>{
    const d=document.createElement("div");
    d.className="frame"+(id===active?" active":"");
    d.innerHTML=`<b>${nodes[id].label}</b><span class="tag">CALL</span>`;
    $("stack").appendChild(d);
  });
}

async function play(auto=true){
  if(playing) return;
  playing=true;
  while(idx<steps.length){
    const s=steps[idx++];
    document.querySelectorAll(".node").forEach(n=>n.classList.remove("active"));
    document.getElementById("node-"+s.id)?.classList.add("active");

    if(s.t==="call"){
      stack.push(s.id);
      log("‚Üí "+nodes[s.id].label);
    }else{
      log("‚Üê returns "+s.v,"ok");
      stack.pop();
    }
    drawStack(s.id);
    if(!auto) break;
    await sleep(500);
  }
  playing=false;
}

function closeHelp(){ $("helpModal").classList.remove("open"); }

$("helpBtn").onclick=()=>$("helpModal").classList.add("open");
$("helpModal").onclick=e=>{
  if(e.target.id==="helpModal") closeHelp();
};

$("build").onclick=build;
$("play").onclick=()=>play(true);
$("step").onclick=()=>play(false);
$("reset").onclick=resetAll;
</script>

</body>
</html>