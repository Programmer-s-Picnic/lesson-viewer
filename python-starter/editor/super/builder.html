<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Programmerâ€™s Picnic â€” Problem Test Builder</title>
    <meta name="description" content="Create problems + tests, auto-generate outputs using Pyodide, export JSON, and load into the main editor." />
    <link rel="stylesheet" href="./style.css" />
    <style>
      .pp-wrap { max-width: 1100px; }
      .pp-grid-builder{ display:grid; grid-template-columns: 1.15fr .85fr; gap:12px; }
      @media (max-width:980px){ .pp-grid-builder{ grid-template-columns:1fr; } }
      .pp-pre{ background:#0b1220;color:#e5e7eb;border-radius:16px;padding:10px;border:1px solid rgba(255,255,255,.08);white-space:pre-wrap;word-break:break-word;max-height:360px;overflow:auto;font-family:var(--pp-mono);font-size:12px; }
      .pp-mini{ font-size:12px;color:var(--pp-muted); }
      .pp-solution{ min-height:140px; }
    </style>
  </head>
  <body>
    <div class="pp-app">
      <div class="pp-wrap">
        <header class="pp-topbar">
          <div class="pp-brand">
            <div class="pp-logo" aria-hidden="true"></div>
            <div>
              <h1 class="pp-title">Problem Test Builder</h1>
              <div class="pp-sub">Create problems + tests â€¢ Auto-generate outputs (Pyodide) â€¢ Export JSON â€¢ Load into main editor</div>
            </div>
          </div>
          <div class="pp-actions">
            <a class="pp-btn" href="./index.html" title="Back to main editor">â¬… Editor</a>
            <button class="pp-btn" id="pbSaveLocal">ðŸ’¾ Save Local</button>
            <button class="pp-btn pp-btn-primary" id="pbDownload">â¬‡ Download JSON</button>
          </div>
        </header>

        <main class="pp-grid-builder">
          <!-- LEFT: Editor -->
          <section class="pp-card">
            <div class="pp-cardhead">
              <div>
                <h2>Problem Details</h2>
                <div class="pp-small">Make a unique <b>id</b>. Add tests. Save. Export.</div>
              </div>
              <div class="pp-toolbar">
                <button class="pp-btn pp-btn-danger" id="pbNew">âž• New</button>
                <button class="pp-btn" id="pbUpdate">âœ… Save / Update</button>
                <button class="pp-btn pp-btn-ghost" id="pbDelete">ðŸ—‘ Delete</button>
              </div>
            </div>

            <div class="pp-pad">
              <div class="pp-row">
                <input id="pbId" class="pp-input" placeholder="id (e.g., sum_two)" style="flex:1;min-width:220px" />
                <input id="pbTitle" class="pp-input" placeholder="title" style="flex:1;min-width:220px" />
              </div>

              <div class="pp-row" style="margin-top:8px">
                <input id="pbLevel" class="pp-input" placeholder="level (Easy/Medium/Hard)" style="flex:1;min-width:180px" />
                <input id="pbTags" class="pp-input" placeholder="tags (comma separated, optional)" style="flex:1;min-width:180px" />
              </div>

              <textarea id="pbStatement" class="pp-textarea" style="width:100%;margin-top:8px;min-height:90px"
                placeholder="Problem statement..."></textarea>

              <textarea id="pbStarter" class="pp-textarea" style="width:100%;margin-top:8px;min-height:120px"
                placeholder="Starter code for students..."></textarea>

              <textarea id="pbHints" class="pp-textarea" style="width:100%;margin-top:8px;min-height:80px"
                placeholder="Hints (one per line)"></textarea>

              <hr style="border:none;border-top:1px solid var(--pp-border);margin:12px 0" />

              <h3 style="margin:0 0 6px;font-size:13px">Teacher Solution (for auto-generating expected outputs)</h3>
              <div class="pp-small">Paste a correct solution here. We'll run it in Pyodide with the test input as stdin and capture stdout.</div>
              <textarea id="pbSolution" class="pp-textarea pp-solution" style="width:100%;margin-top:8px"
                placeholder="Example:
n=int(input())
print(n*(n+1)//2)
"></textarea>

              <div class="pp-row" style="margin-top:8px">
                <button class="pp-btn pp-btn-primary" id="pbInitPy">âš™ Load Pyodide</button>
                <span class="pp-pill">Pyodide: <b id="pbPyStatus">not loaded</b></span>
              </div>

              <hr style="border:none;border-top:1px solid var(--pp-border);margin:12px 0" />

              <div class="pp-row" style="align-items:flex-start">
                <textarea id="pbTestIn" class="pp-textarea pp-io" style="flex:1;min-width:240px"
                  placeholder="Test input (exact)"></textarea>
                <textarea id="pbTestOut" class="pp-textarea pp-io" style="flex:1;min-width:240px"
                  placeholder="Expected output (exact)"></textarea>
              </div>

              <div class="pp-row" style="margin-top:8px">
                <label class="pp-toggle"><input type="checkbox" id="pbHidden" /> Hidden</label>
                <button class="pp-btn" id="pbGenOutOne">âœ¨ Generate Output</button>
                <button class="pp-btn" id="pbAddTest">âž• Add Test</button>
                <button class="pp-btn pp-btn-danger" id="pbClearTests">ðŸ§¹ Clear Tests</button>
                <span class="pp-pill">Tests: <b id="pbTestCount">0</b></span>
              </div>

              <div class="pp-row" style="margin-top:8px">
                <button class="pp-btn" id="pbGenOutAll">âœ¨ Generate outputs for tests missing output</button>
              </div>

              <div class="pp-mini" style="margin-top:8px">
                Tip: Add 2 visible tests (become examples) + 3â€“10 hidden tests.
              </div>
            </div>
          </section>

          <!-- RIGHT: Library + Export/Import -->
          <aside class="pp-split" style="grid-template-rows:auto auto 1fr;">
            <section class="pp-card">
              <div class="pp-cardhead">
                <div>
                  <h2>Problem Library</h2>
                  <div class="pp-small">Saved in this browser (localStorage)</div>
                </div>
                <div class="pp-toolbar">
                  <button class="pp-btn" id="pbExportText">ðŸ“‹ Copy JSON</button>
                </div>
              </div>
              <div class="pp-pad">
                <div class="pp-row">
                  <select id="pbList" class="pp-select" style="flex:1;min-width:260px"></select>
                  <button class="pp-btn" id="pbLoad">ðŸ“¥ Load</button>
                </div>

                <div class="pp-row" style="margin-top:10px">
                  <button class="pp-btn" id="pbImportBtn">ðŸ“¥ Import JSON file</button>
                  <input id="pbImportFile" type="file" accept="application/json" style="display:none" />
                </div>

                <div class="pp-row" style="margin-top:10px">
                  <input id="pbMainUrl" class="pp-input" style="width:100%"
                    placeholder="Your hosted problems.json URL (GitHub Pages)..."/>
                </div>
                <div class="pp-row" style="margin-top:8px">
                  <button class="pp-btn pp-btn-primary" id="pbCopyEditorLink">ðŸ”— Copy Editor Link</button>
                </div>

                <div class="pp-mini" style="margin-top:8px">
                  Editor link format:<br />
                  <span class="pp-mono">index.html?problems=YOUR_JSON_URL</span>
                </div>
              </div>
            </section>

            <section class="pp-card">
              <div class="pp-cardhead">
                <div>
                  <h2>JSON Preview</h2>
                  <div class="pp-small">This is what the editor will load</div>
                </div>
                <div class="pp-toolbar">
                  <button class="pp-btn pp-btn-ghost" id="pbValidate">âœ… Validate</button>
                </div>
              </div>
              <div class="pp-pad">
                <div class="pp-pre" id="pbPreview"></div>
              </div>
            </section>

            <section class="pp-card">
              <div class="pp-cardhead">
                <div>
                  <h2>Status</h2>
                  <div class="pp-small">Builder messages</div>
                </div>
              </div>
              <div class="pp-pad">
                <div class="pp-out" style="min-height:120px" id="pbStatus"></div>
              </div>
            </section>
          </aside>
        </main>

        <div class="pp-toast" id="ppToast"></div>
      </div>
    </div>

    <!-- Pyodide for auto-generate outputs -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.26.2/full/pyodide.js"></script>
    <script src="./builder.js"></script>
  </body>
</html>
