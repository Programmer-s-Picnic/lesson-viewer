<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Python Shorts Maker ‚Äì Blogger Safe</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  padding:14px;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:#fff7ed;
  color:#0f172a;
}
h1{
  margin:6px 0 2px;
  text-align:center;
  color:#92400e;
}
.subtitle{
  text-align:center;
  font-size:13px;
  color:#6b7280;
  margin-bottom:10px;
}
.status{
  text-align:center;
  font-size:13px;
  margin-bottom:8px;
}
.main{
  display:grid;
  grid-template-columns:1.1fr 0.9fr;
  gap:12px;
  max-width:1200px;
  margin:auto;
}
.card{
  background:#fff;
  border:1px solid #e5e7eb;
  border-radius:12px;
  box-shadow:0 8px 24px rgba(0,0,0,.06);
}
.card-header{
  padding:8px 12px;
  border-bottom:1px solid #e5e7eb;
  font-weight:600;
  font-size:14px;
}
textarea{
  width:100%;
  height:60vh;
  border:none;
  resize:none;
  padding:12px;
  font-family:ui-monospace,Menlo,Consolas,monospace;
  font-size:13px;
  line-height:1.6;
  background:#0b1220;
  color:#e5e7eb;
  border-radius:0 0 12px 12px;
}
.right{
  display:flex;
  flex-direction:column;
  gap:10px;
}
.toolbar{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:6px;
  padding:10px;
}
button{
  padding:8px;
  border:none;
  border-radius:6px;
  background:#f97316;
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
button.secondary{background:#334155}
button.stop{background:#991b1b}
button:disabled{opacity:.5;cursor:not-allowed}
.uploads{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:6px;
  padding:10px;
  font-size:13px;
}
.preview{
  padding:10px;
  text-align:center;
}
canvas{
  width:360px;
  height:640px;
  border-radius:16px;
  background:black;
  box-shadow:0 16px 40px rgba(0,0,0,.35);
}
.note{
  font-size:12px;
  color:#6b7280;
  padding:8px;
  text-align:center;
}
@media(max-width:900px){
  .main{grid-template-columns:1fr}
  textarea{height:50vh}
  canvas{width:300px;height:533px}
}
</style>
</head>

<body>

<h1>Python Shorts Maker</h1>
<div class="subtitle">Blogger-safe ‚Ä¢ Editable Python ‚Ä¢ Canvas Video</div>

<div id="py-status" class="status">
‚è≥ Loading Python engine (first time ~15‚Äì20 seconds)‚Ä¶
</div>

<div class="main">

  <!-- PYTHON EDITOR -->
  <div class="card">
    <div class="card-header">üêç Python Controller (Edit & Run)</div>
<textarea id="pycode">
# ===== EDIT THIS PYTHON CODE =====

MAX_FRAMES = 240
BODY_DRIFT_PX = 160

HOOK_TEXT = "STOP SCROLLING üëá"
BODY_TEXT = "Most students misuse binary search."
WATERMARK = "Programmer‚Äôs Picnic"

VOICE_VOLUME = 1.0
MUSIC_VOLUME = 0.15
</textarea>
  </div>

  <!-- RIGHT PANEL -->
  <div class="right">

    <div class="card toolbar">
      <button id="runBtn" onclick="runPython()" disabled>Run Python ‚ñ∂</button>
      <button class="secondary" onclick="startRecording()">Record üé•</button>
      <button class="stop" onclick="stopRecording()">Stop ‚èπ</button>
    </div>

    <div class="card uploads">
      <label>üé§ Voice
        <input type="file" id="voice" accept="audio/*">
      </label>
      <label>üéµ Music
        <input type="file" id="music" accept="audio/*">
      </label>
    </div>

    <div class="card preview">
      <canvas id="canvas" width="360" height="640"></canvas>
    </div>

    <div class="card note">
      Flow: Edit Python ‚Üí Run ‚Üí Preview ‚Üí Record ‚Üí Download (WebM)
    </div>

  </div>
</div>

<!-- PYODIDE (DO NOT MOVE THIS) -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>

<script>
let pyodide=null;
let pyReady=false;
let STATE={};

const statusEl=document.getElementById("py-status");
const runBtn=document.getElementById("runBtn");

const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

let frame=0,running=false;
let recorder,chunks=[];
let voiceAudio,musicAudio;

/* ---------- PYODIDE INIT (BLOGGER SAFE) ---------- */
async function initPyodideSafe(){
  try{
    pyodide=await loadPyodide({
      indexURL:"https://cdn.jsdelivr.net/pyodide/v0.24.1/full/"
    });
    pyReady=true;
    statusEl.innerText="‚úÖ Python ready. Click Run Python.";
    runBtn.disabled=false;
  }catch(e){
    console.error(e);
    statusEl.innerText="‚ùå Pyodide failed to load on Blogger.";
  }
}
initPyodideSafe();

/* ---------- RUN PYTHON ---------- */
async function runPython(){
  if(!pyReady){
    alert("Python still loading. Please wait.");
    return;
  }

  await pyodide.runPythonAsync(
    document.getElementById("pycode").value
  );

  STATE.MAX_FRAMES=pyodide.globals.get("MAX_FRAMES");
  STATE.DRIFT=pyodide.globals.get("BODY_DRIFT_PX");
  STATE.HOOK=pyodide.globals.get("HOOK_TEXT");
  STATE.BODY=pyodide.globals.get("BODY_TEXT");
  STATE.WM=pyodide.globals.get("WATERMARK");

  frame=0;
  running=true;
  draw();
}

/* ---------- DRAW BACKGROUND ---------- */
function bg(){
  const g=ctx.createLinearGradient(0,0,0,640);
  g.addColorStop(0,"#ff9933");
  g.addColorStop(1,"#fff0d5");
  ctx.fillStyle=g;
  ctx.fillRect(0,0,360,640);
}

/* ---------- DRAW FRAME ---------- */
function draw(){
  if(!running)return;

  bg();

  // Hook
  ctx.fillStyle="rgba(0,0,0,.7)";
  ctx.fillRect(0,0,360,70);
  ctx.fillStyle="#fff";
  ctx.font="20px sans-serif";
  ctx.textAlign="left";
  ctx.fillText(STATE.HOOK,20,45);

  // Body (Python-controlled animation)
  const p=frame/STATE.MAX_FRAMES;
  const d=p*STATE.DRIFT;
  ctx.fillStyle="#222";
  ctx.font="18px sans-serif";
  ctx.fillText(STATE.BODY,20,360-d);

  // Watermark
  ctx.fillStyle="rgba(0,0,0,.7)";
  ctx.fillRect(0,580,360,60);
  ctx.fillStyle="#fff";
  ctx.textAlign="center";
  ctx.font="14px sans-serif";
  ctx.fillText(STATE.WM,180,615);

  frame++;
  if(frame<STATE.MAX_FRAMES){
    requestAnimationFrame(draw);
  }else{
    running=false;
  }
}

/* ---------- RECORD VIDEO ---------- */
function startRecording(){
  frame=0;
  running=true;

  if(voice.files[0]){
    voiceAudio=new Audio(URL.createObjectURL(voice.files[0]));
    voiceAudio.volume=1.0;
  }
  if(music.files[0]){
    musicAudio=new Audio(URL.createObjectURL(music.files[0]));
    musicAudio.volume=0.15;
    musicAudio.loop=true;
  }

  const stream=canvas.captureStream(30);
  recorder=new MediaRecorder(stream,{mimeType:"video/webm"});
  chunks=[];

  recorder.ondataavailable=e=>chunks.push(e.data);
  recorder.onstop=()=>{
    const blob=new Blob(chunks,{type:"video/webm"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="short.webm";
    a.click();
  };

  recorder.start();
  voiceAudio&&voiceAudio.play();
  musicAudio&&musicAudio.play();
  draw();
}

/* ---------- STOP ---------- */
function stopRecording(){
  running=false;
  recorder&&recorder.stop();
  voiceAudio&&voiceAudio.pause();
  musicAudio&&musicAudio.pause();
}
</script>

</body>
</html>