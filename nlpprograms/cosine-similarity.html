<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cosine Similarity — Animated Angle Lab</title>

<style>
:root{
--bg:#fffaf2;--card:#ffffff;--ink:#1f2937;--muted:#6b7280;
--brand:#d97706;--border:#e5e7eb;--ok:#059669;
--warn:#b45309;--bad:#dc2626;--radius:16px;
--shadow:0 10px 30px rgba(0,0,0,.06);
font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
body{margin:0;background:linear-gradient(180deg,var(--bg),#fff);color:var(--ink)}
header{text-align:center;padding:24px}
.wrap{max-width:1100px;margin:auto;padding:16px}
.grid{display:grid;gap:16px}
@media(min-width:980px){.grid{grid-template-columns:1.1fr .9fr}}
.card{background:var(--card);border:1px solid var(--border);
border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
textarea,select{width:100%;border:1px solid var(--border);
border-radius:12px;padding:10px;font:inherit}
button{border:none;border-radius:12px;padding:10px 14px;
font-weight:700;cursor:pointer;background:var(--brand);color:#fff}
button.ghost{background:#f3f4f6;color:#111;border:1px solid var(--border)}
pre{background:#0b1020;color:#e5e7eb;border-radius:12px;padding:12px}
.row{display:flex;gap:10px;flex-wrap:wrap}
.status{margin-top:10px;padding:10px;border-radius:12px;font-weight:700}
.status.ok{background:#ecfdf5;color:#065f46}
.legend{display:flex;gap:14px;margin-top:8px;font-size:14px;flex-wrap:wrap}
.legend i{width:14px;height:14px;border-radius:3px;display:inline-block}
.explain{margin-top:10px;font-size:14px;color:var(--muted);line-height:1.7}
footer{text-align:center;font-size:13px;color:var(--muted);margin:20px}
</style>
</head>

<body>

<header>
<h1>Cosine Similarity — Animated Vector Angles</h1>
<p>Watch similarity change as the angle animates between sentence vectors.</p>
</header>

<div class="wrap">
<div class="grid">

<section class="card">
<h2>What’s New in This Upgrade</h2>
<ul>
<li>Angle θ animates smoothly when you run Python</li>
<li>Color zones show similarity ranges</li>
<li>Math → Geometry → Meaning is now obvious</li>
</ul>
</section>

<aside class="card">
<h2>Live Python Lab</h2>

<label><b>Sentence 1</b></label>
<textarea id="s1">show me quizzes</textarea>

<label><b>Sentence 2</b></label>
<textarea id="s2">open quizzes</textarea>

<label><b>Stopwords</b></label>
<select id="stop">
<option value="yes">Remove stopwords</option>
<option value="no">Keep stopwords</option>
</select>

<div class="row" style="margin-top:10px;">
<button id="run">Run Python</button>
</div>

<div id="status" class="status ok">✅ Pyodide Ready</div>

<h3>Output</h3>
<pre id="out">Click Run.</pre>

<h3>Animated Vector Graph</h3>
<div style="border:1px solid var(--border);border-radius:12px;padding:12px">

<svg id="svg" viewBox="0 0 520 320" width="100%" height="320">
<defs>
<marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
<path d="M0,0 L10,3 L0,6 Z" fill="currentColor"/>
</marker>
</defs>

<!-- Similarity zones -->
<path id="zoneGood" fill="rgba(5,150,105,0.15)"/>
<path id="zoneMid"  fill="rgba(245,158,11,0.18)"/>
<path id="zoneBad"  fill="rgba(220,38,38,0.15)"/>

<!-- Axes -->
<line x1="60" y1="260" x2="500" y2="260" stroke="#bbb" stroke-width="2"/>
<line x1="260" y1="20" x2="260" y2="300" stroke="#bbb" stroke-width="2"/>

<!-- Origin -->
<circle cx="260" cy="260" r="4" fill="#555"/>

<!-- Vectors -->
<line id="vecA" x1="260" y1="260" x2="355" y2="260"
stroke="#2563eb" stroke-width="4" marker-end="url(#arrow)"/>
<line id="vecB" x1="260" y1="260" x2="355" y2="260"
stroke="#d97706" stroke-width="4" marker-end="url(#arrow)"/>

<!-- Animated angle -->
<path id="angleArc" fill="none" stroke="#059669" stroke-width="4"/>

<text id="label" x="16" y="24" font-size="15" fill="#065f46">
θ = --° | cos = --
</text>
</svg>

<div class="legend">
<span><i style="background:#2563eb"></i> Sentence 1</span>
<span><i style="background:#d97706"></i> Sentence 2</span>
<span><i style="background:#059669"></i> Angle θ</span>
</div>

<div class="explain">
<b>How to read this animation:</b><br/>
• Smaller green angle → vectors point in same direction → meanings are similar.<br/>
• Medium yellow region → partial overlap of meaning.<br/>
• Large red region → meanings are unrelated.
</div>

</div>
</aside>

</div>

<footer>
By <b>Champak Roy</b> • Programmer’s Picnic
</footer>
</div>

<script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>

<script>
let pyodide;
(async()=>{
pyodide = await loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.23.4/full/"});
})();

const code = `
import math, json, re

def tok(t):
 t=t.lower()
 t=re.sub(r"[^a-z0-9\\s]"," ",t)
 return t.split()

t1,t2=tok(S1),tok(S2)
v=sorted(set(t1)|set(t2))
A=[t1.count(x) for x in v]
B=[t2.count(x) for x in v]

dot=sum(a*b for a,b in zip(A,B))
ma=math.sqrt(sum(x*x for x in A))
mb=math.sqrt(sum(x*x for x in B))
cos=0 if ma*mb==0 else dot/(ma*mb)
theta=math.degrees(math.acos(max(-1,min(1,cos))))

print("__DATA__"+json.dumps({"cos":cos,"theta":theta}))
`;

function arc(cx,cy,r,a){
const x=cx+r*Math.cos(a), y=cy-r*Math.sin(a);
return `M ${cx+r} ${cy} A ${r} ${r} 0 0 0 ${x} ${y}`;
}

function animateAngle(theta, cos){
const cx=260, cy=260, r=48;
let t=0, steps=30;
const label=document.getElementById("label");
const arcEl=document.getElementById("angleArc");

function step(){
t++;
const a=(theta*Math.PI/180)*(t/steps);
arcEl.setAttribute("d",arc(cx,cy,r,a));
label.textContent=`θ = ${(a*180/Math.PI).toFixed(1)}° | cos = ${cos.toFixed(4)}`;
if(t<steps) requestAnimationFrame(step);
}
step();
}

run.onclick=async()=>{
pyodide.globals.set("S1",s1.value);
pyodide.globals.set("S2",s2.value);
const r=await pyodide.runPythonAsync(code);
out.textContent=r;
const d=JSON.parse(r.slice(r.indexOf("{")));
animateAngle(d.theta,d.cos);
};
</script>

</body>
</html>