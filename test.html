<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Birthday Card Maker (HTML) ‚Äî Templates + Print + WhatsApp</title>
    <style>
      :root {
        --bg: #fff7e6;
        --card: #ffffff;
        --ink: #1f2937;
        --muted: #6b7280;
        --brand: #d97706;
        --brand2: #ff8a00;
        --border: #f3d7a6;
        --shadow: 0 18px 45px rgba(31, 41, 55, 0.14);
        --ok: #166534;
        --danger: #b91c1c;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica,
          Arial;
        background: radial-gradient(
            900px 600px at 15% 10%,
            rgba(255, 138, 0, 0.18),
            transparent 60%
          ),
          radial-gradient(
            900px 600px at 85% 10%,
            rgba(255, 194, 106, 0.28),
            transparent 55%
          ),
          linear-gradient(180deg, var(--bg), #fff);
        color: var(--ink);
      }
      header {
        padding: 18px 16px;
        border-bottom: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(6px);
        position: sticky;
        top: 0;
        z-index: 10;
      }
      .topbar {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }
      h1 {
        margin: 0;
        font-size: 18px;
        letter-spacing: 0.2px;
        color: var(--brand);
      }
      .btnrow {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: flex-end;
      }
      button {
        border: none;
        border-radius: 999px;
        padding: 10px 14px;
        background: linear-gradient(180deg, #ffb85c, var(--brand2));
        color: #fff;
        cursor: pointer;
        font-weight: 700;
        box-shadow: 0 10px 22px rgba(217, 119, 6, 0.18);
      }
      button.secondary {
        background: #fff;
        color: var(--brand);
        border: 1px solid var(--border);
        box-shadow: none;
      }
      button:active {
        transform: translateY(1px);
      }

      .wrap {
        max-width: 1200px;
        margin: 18px auto;
        padding: 0 16px 24px;
      }
      .grid {
        display: grid;
        gap: 14px;
      }
      @media (min-width: 1000px) {
        .grid {
          grid-template-columns: 420px 1fr;
          align-items: start;
        }
      }

      .panel {
        background: rgba(255, 255, 255, 0.86);
        border: 1px solid var(--border);
        border-radius: 18px;
        box-shadow: var(--shadow);
        overflow: hidden;
      }
      .panel h2 {
        margin: 0;
        padding: 14px 14px 10px;
        font-size: 14px;
        color: #7c2d12;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        border-bottom: 1px solid var(--border);
        background: linear-gradient(
          180deg,
          rgba(255, 232, 191, 0.65),
          rgba(255, 255, 255, 0.6)
        );
      }

      form {
        padding: 14px;
        display: grid;
        gap: 12px;
      }
      label {
        font-size: 12px;
        color: var(--muted);
        display: grid;
        gap: 6px;
      }
      input,
      textarea,
      select {
        width: 100%;
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 10px 10px;
        font: inherit;
        background: #fff;
        color: var(--ink);
        outline: none;
      }
      textarea {
        min-height: 74px;
        resize: vertical;
      }
      .row {
        display: grid;
        gap: 12px;
      }
      @media (min-width: 520px) {
        .row {
          grid-template-columns: 1fr 1fr;
        }
      }

      .toggles {
        display: grid;
        gap: 10px;
      }
      .toggle {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: 14px;
        background: rgba(255, 247, 230, 0.6);
      }
      .toggle strong {
        font-size: 13px;
      }
      .toggle small {
        display: block;
        color: var(--muted);
        margin-top: 2px;
      }
      .toggle input {
        width: 44px;
        height: 24px;
        accent-color: var(--brand2);
      }

      .hint {
        font-size: 12px;
        color: var(--muted);
        padding: 0 14px 14px;
        line-height: 1.45;
      }

      .previewWrap {
        padding: 14px;
      }
      .previewFrame {
        width: 100%;
        aspect-ratio: 3/4;
        border: 1px solid var(--border);
        border-radius: 14px;
        overflow: hidden;
        background: #fff;
      }
      iframe {
        width: 100%;
        height: 100%;
        border: 0;
        background: #fff;
      }

      .status {
        margin-left: 12px;
        font-size: 12px;
        color: var(--muted);
      }
      .status.ok {
        color: var(--ok);
      }
      .status.bad {
        color: var(--danger);
      }

      .mini {
        padding: 10px 14px 14px;
        border-top: 1px solid var(--border);
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
        justify-content: space-between;
      }
      .mini code {
        font-size: 12px;
        color: #7c2d12;
        background: rgba(255, 232, 191, 0.7);
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid var(--border);
      }

      .thumbs {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 10px;
        margin-top: 6px;
      }
      .thumb {
        border: 1px solid var(--border);
        border-radius: 14px;
        background: #fff;
        padding: 10px;
        cursor: pointer;
        box-shadow: 0 10px 22px rgba(217, 119, 6, 0.1);
        position: relative;
        transition: transform 0.12s ease, box-shadow 0.12s ease,
          border-color 0.12s ease;
      }
      .thumb:active {
        transform: translateY(1px);
      }
      .thumb:hover {
        box-shadow: 0 14px 28px rgba(217, 119, 6, 0.14);
      }
      .thumb.selected {
        outline: 3px solid rgba(217, 119, 6, 0.25);
        border-color: #f0b56d;
      }
      .t-canvas {
        border-radius: 10px;
        border: 1px solid rgba(243, 215, 166, 0.9);
        overflow: hidden;
        aspect-ratio: 3/4;
      }
      .t-top {
        height: 38%;
      }
      .t-body {
        padding: 10px;
      }
      .t-line {
        height: 10px;
        border-radius: 999px;
        background: rgba(31, 41, 55, 0.14);
        margin: 8px 0;
      }
      .t-line.sm {
        height: 8px;
        opacity: 0.8;
      }
      .t-chip {
        display: inline-block;
        margin-top: 6px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid rgba(243, 215, 166, 0.9);
        font-size: 11px;
        color: #7c2d12;
        background: rgba(255, 247, 230, 0.6);
      }
      .t-label {
        margin-top: 8px;
        font-size: 12px;
        color: #7c2d12;
        font-weight: 800;
      }

      .thumb.pastel .t-top {
        background: linear-gradient(
          180deg,
          rgba(147, 197, 253, 0.85),
          rgba(236, 253, 245, 0.2)
        );
      }
      .thumb.neon .t-top {
        background: linear-gradient(
          180deg,
          rgba(217, 70, 239, 0.55),
          rgba(34, 211, 238, 0.15)
        );
      }
      .thumb.elegant .t-top {
        background: linear-gradient(
          180deg,
          rgba(17, 24, 39, 0.65),
          rgba(202, 160, 74, 0.08)
        );
      }
      .thumb.kids .t-top {
        background: linear-gradient(
          180deg,
          rgba(251, 191, 36, 0.75),
          rgba(252, 165, 165, 0.18)
        );
      }

      .thumb.neon .spark {
        position: absolute;
        inset: 10px;
        border-radius: 12px;
        pointer-events: none;
        background: radial-gradient(
            circle at 20% 30%,
            rgba(34, 211, 238, 0.35),
            transparent 40%
          ),
          radial-gradient(
            circle at 75% 20%,
            rgba(217, 70, 239, 0.35),
            transparent 40%
          ),
          radial-gradient(
            circle at 70% 80%,
            rgba(34, 197, 94, 0.25),
            transparent 45%
          );
        mix-blend-mode: multiply;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="topbar">
        <h1>Birthday Card Maker (HTML)</h1>
        <div class="btnrow">
          <button class="secondary" id="btnCopy" type="button">
            Copy HTML
          </button>
          <button class="secondary" id="btnDownload" type="button">
            Download .html
          </button>
          <button id="btnReset" class="secondary" type="button">Reset</button>
        </div>
      </div>
    </header>

    <main class="wrap">
      <div class="grid">
        <section class="panel">
          <h2>Card Details</h2>
          <form id="f">
            <div class="row">
              <label>
                Language mode
                <select id="langMode">
                  <option value="hi">Hindi (‡§π‡§ø‡§®‡•ç‡§¶‡•Ä)</option>
                  <option value="en" selected>English</option>
                  <option value="both">Hindi + English</option>
                </select>
              </label>
              <label>
                Template
                <select id="tpl">
                  <option value="pastel" selected>Pastel Sky</option>
                  <option value="neon">Neon Party</option>
                  <option value="elegant">Elegant Gold</option>
                  <option value="kids">Kids Fun</option>
                </select>
                <div class="thumbs" id="thumbs">
                  <div
                    class="thumb pastel selected"
                    data-tpl="pastel"
                    role="button"
                    tabindex="0"
                    aria-label="Pastel Sky"
                  >
                    <div class="t-canvas">
                      <div class="t-top"></div>
                      <div class="t-body">
                        <div class="t-line"></div>
                        <div class="t-line sm" style="width: 72%"></div>
                        <div class="t-line" style="width: 85%"></div>
                        <span class="t-chip">Soft</span>
                      </div>
                    </div>
                    <div class="t-label">Pastel</div>
                  </div>
                  <div
                    class="thumb neon"
                    data-tpl="neon"
                    role="button"
                    tabindex="0"
                    aria-label="Neon Party"
                  >
                    <div class="spark" aria-hidden="true"></div>
                    <div class="t-canvas">
                      <div class="t-top"></div>
                      <div class="t-body">
                        <div class="t-line"></div>
                        <div class="t-line sm" style="width: 66%"></div>
                        <div class="t-line" style="width: 82%"></div>
                        <span class="t-chip">Glow</span>
                      </div>
                    </div>
                    <div class="t-label">Neon</div>
                  </div>
                  <div
                    class="thumb elegant"
                    data-tpl="elegant"
                    role="button"
                    tabindex="0"
                    aria-label="Elegant Gold"
                  >
                    <div class="t-canvas">
                      <div class="t-top"></div>
                      <div class="t-body">
                        <div class="t-line"></div>
                        <div class="t-line sm" style="width: 70%"></div>
                        <div class="t-line" style="width: 78%"></div>
                        <span class="t-chip">Gold</span>
                      </div>
                    </div>
                    <div class="t-label">Elegant</div>
                  </div>
                  <div
                    class="thumb kids"
                    data-tpl="kids"
                    role="button"
                    tabindex="0"
                    aria-label="Kids Fun"
                  >
                    <div class="t-canvas">
                      <div class="t-top"></div>
                      <div class="t-body">
                        <div class="t-line"></div>
                        <div class="t-line sm" style="width: 74%"></div>
                        <div class="t-line" style="width: 88%"></div>
                        <span class="t-chip">Fun</span>
                      </div>
                    </div>
                    <div class="t-label">Kids</div>
                  </div>
                </div>
              </label>
            </div>

            <div class="row">
              <label>
                Celebrant name
                <input id="name" value="Aarav" />
              </label>
              <label>
                Age (optional)
                <input id="age" type="number" min="0" step="1" value="10" />
              </label>
            </div>

            <div class="row">
              <label>
                Date / ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï
                <input id="date" value="23 Jan 2026" />
              </label>
              <label>
                From (sender)
                <input id="from" value="Champak Roy" />
              </label>
            </div>

            <label>
              Message
              <textarea id="msg">
Wishing you a day filled with happiness, laughter, and lots of cake! üéÇ</textarea
              >
            </label>

            <label>
              Optional photo (local)
              <input id="photo" type="file" accept="image/*" />
            </label>

            <div class="row">
              <label>
                WhatsApp phone (optional)
                <input id="waPhone" placeholder="e.g. 91XXXXXXXXXX" />
              </label>
              <label>
                Confetti intensity
                <select id="confetti">
                  <option value="low">Low</option>
                  <option value="med" selected>Medium</option>
                  <option value="high">High</option>
                </select>
              </label>
            </div>

            <div class="toggles" aria-label="Effects">
              <div class="toggle">
                <div>
                  <strong>Animated balloons</strong
                  ><small>Balloons float up softly in the background.</small>
                </div>
                <input id="tBalloons" type="checkbox" checked />
              </div>
              <div class="toggle">
                <div>
                  <strong>Confetti</strong
                  ><small>Confetti falls from the top (auto-loop).</small>
                </div>
                <input id="tConfetti" type="checkbox" checked />
              </div>
              <div class="toggle">
                <div>
                  <strong>Music button</strong
                  ><small>Plays a short birthday tune (online audio).</small>
                </div>
                <input id="tMusic" type="checkbox" checked />
              </div>
            </div>
          </form>
          <div class="hint">
            Tip: Pick a template thumbnail, add name/message/photo, then
            download a single HTML card. Offline works except music + (optional)
            WhatsApp.
          </div>
        </section>

        <section class="panel">
          <h2>Live Preview</h2>
          <div class="previewWrap">
            <div class="previewFrame">
              <iframe
                id="pv"
                title="Preview"
                sandbox="allow-scripts allow-downloads"
              ></iframe>
            </div>
          </div>
          <div class="mini">
            <div>
              <code id="mode">mode: en ‚Ä¢ tpl: pastel</code>
              <span class="status" id="status">Ready</span>
            </div>
            <button id="btnRefresh" type="button">Refresh Preview</button>
          </div>
        </section>
      </div>
    </main>

    <script>
      const $ = (id) => document.getElementById(id);
      const els = {
        langMode: $("langMode"),
        tpl: $("tpl"),
        thumbs: $("thumbs"),
        name: $("name"),
        age: $("age"),
        date: $("date"),
        from: $("from"),
        msg: $("msg"),
        photo: $("photo"),
        waPhone: $("waPhone"),
        confetti: $("confetti"),
        tBalloons: $("tBalloons"),
        tConfetti: $("tConfetti"),
        tMusic: $("tMusic"),
        pv: $("pv"),
        mode: $("mode"),
        status: $("status"),
        btnRefresh: $("btnRefresh"),
        btnCopy: $("btnCopy"),
        btnDownload: $("btnDownload"),
        btnReset: $("btnReset"),
        form: $("f"),
      };

      let photoDataUrl = "";

      function escHtml(str) {
        return String(str ?? "")
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#39;");
      }

      function setStatus(text, ok = true) {
        els.status.textContent = text;
        els.status.classList.toggle("ok", !!ok);
        els.status.classList.toggle("bad", !ok);
      }

      function setSelectedThumb(tpl) {
        document.querySelectorAll(".thumb").forEach((t) => {
          t.classList.toggle("selected", t.dataset.tpl === tpl);
        });
      }

      function normalizePhone(p) {
        return String(p || "")
          .replace(/[^\d]/g, "")
          .trim();
      }

      function confettiParams(level) {
        if (level === "low") return { count: 80, speed: 0.9 };
        if (level === "high") return { count: 260, speed: 1.5 };
        return { count: 160, speed: 1.2 };
      }

      function cardTheme(tpl) {
        const themes = {
          pastel: {
            bg1: "rgba(147,197,253,.90)",
            bg2: "rgba(236,253,245,.25)",
            accent: "#2563eb",
            accent2: "#16a34a",
            ink: "#0f172a",
            card: "#ffffff",
          },
          neon: {
            bg1: "rgba(217,70,239,.55)",
            bg2: "rgba(34,211,238,.16)",
            accent: "#d946ef",
            accent2: "#22d3ee",
            ink: "#0b1220",
            card: "#0b1220",
          },
          elegant: {
            bg1: "rgba(17,24,39,.72)",
            bg2: "rgba(202,160,74,.10)",
            accent: "#caa04a",
            accent2: "#f5d27a",
            ink: "#111827",
            card: "#ffffff",
          },
          kids: {
            bg1: "rgba(251,191,36,.78)",
            bg2: "rgba(252,165,165,.20)",
            accent: "#f59e0b",
            accent2: "#fb7185",
            ink: "#1f2937",
            card: "#ffffff",
          },
        };
        return themes[tpl] || themes.pastel;
      }

      function getData() {
        const langMode = els.langMode.value;
        const tpl = els.tpl.value;
        const name = els.name.value.trim() || "Friend";
        const age = String(els.age.value || "").trim();
        const date = els.date.value.trim();
        const from = els.from.value.trim() || "";
        const msg = els.msg.value.trim() || "";
        const waPhone = normalizePhone(els.waPhone.value);
        const confetti = els.confetti.value;
        const balloons = els.tBalloons.checked;
        const confettiOn = els.tConfetti.checked;
        const music = els.tMusic.checked;

        return {
          langMode,
          tpl,
          name,
          age,
          date,
          from,
          msg,
          waPhone,
          confetti,
          balloons,
          confettiOn,
          music,
          photoDataUrl,
        };
      }

      function buildCardHtml(d) {
        const T = cardTheme(d.tpl);
        const hasAge =
          d.age && !Number.isNaN(Number(d.age)) && Number(d.age) > 0;
        const ageTextEn = hasAge ? `Turning ${escHtml(d.age)}!` : "";
        const ageTextHi = hasAge ? `‡§Ö‡§¨ ${escHtml(d.age)} ‡§∏‡§æ‡§≤ ‡§ï‡•á!` : "";

        const showHi = d.langMode === "hi" || d.langMode === "both";
        const showEn = d.langMode === "en" || d.langMode === "both";

        const nameEn = escHtml(d.name);
        const nameHi = escHtml(d.name);

        const dateLineEn = d.date ? `Date: ${escHtml(d.date)}` : "";
        const dateLineHi = d.date ? `‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${escHtml(d.date)}` : "";

        const msgEn = d.msg ? escHtml(d.msg) : "";
        const msgHi = d.msg ? escHtml(d.msg) : "";

        const fromEn = d.from
          ? `From: <strong>${escHtml(d.from)}</strong>`
          : "";
        const fromHi = d.from
          ? `‡§™‡•ç‡§∞‡•á‡§∑‡§ï: <strong>${escHtml(d.from)}</strong>`
          : "";

        const waText = `Birthday card for ${d.name}${
          d.date ? " ‚Ä¢ " + d.date : ""
        }`;
        const waShareLink = d.waPhone
          ? `https://wa.me/${d.waPhone}?text=${encodeURIComponent(waText)}`
          : `https://wa.me/?text=${encodeURIComponent(waText)}`;

        const conf = confettiParams(d.confetti);

        // IMPORTANT FIX: inside this string, close script tags as <\/script> to avoid breaking THIS page.
        return `<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Birthday Card ‚Äî ${nameEn}</title>
<style>
  :root{
    --bg1:${T.bg1};
    --bg2:${T.bg2};
    --accent:${T.accent};
    --accent2:${T.accent2};
    --ink:${T.ink};
    --card:${T.card};
    --shadow: 0 18px 45px rgba(15,23,42,.22);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    color: var(--ink);
    background:
      radial-gradient(900px 600px at 10% 10%, var(--bg1), transparent 60%),
      radial-gradient(900px 600px at 85% 15%, var(--bg2), transparent 58%),
      linear-gradient(180deg, #fff7e6, #ffffff);
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:18px;
  }
  .card{
    width:min(720px, 100%);
    border-radius:22px;
    overflow:hidden;
    background: rgba(255,255,255,.92);
    border:1px solid rgba(243,215,166,.9);
    box-shadow: var(--shadow);
    position:relative;
  }
  .hero{
    position:relative;
    padding:26px 22px 16px;
    background:
      radial-gradient(600px 320px at 15% 20%, rgba(255,255,255,.55), transparent 55%),
      radial-gradient(700px 360px at 90% 10%, rgba(255,255,255,.35), transparent 55%),
      linear-gradient(180deg, rgba(255,232,191,.75), rgba(255,255,255,.30));
  }
  .badge{
    display:inline-flex;
    gap:8px;
    align-items:center;
    padding:8px 12px;
    border-radius:999px;
    background: rgba(255,255,255,.65);
    border:1px solid rgba(243,215,166,.95);
    font-weight:800;
    color:#7c2d12;
    font-size:12px;
    letter-spacing:.06em;
    text-transform:uppercase;
  }
  .title{
    margin:14px 0 0;
    font-size:42px;
    line-height:1.05;
    letter-spacing:-.02em;
    color:#7c2d12;
  }
  .name{
    margin:10px 0 0;
    font-size:30px;
    font-weight:900;
    color: var(--accent);
  }
  .sub{
    margin:10px 0 0;
    display:flex;
    flex-wrap:wrap;
    gap:10px 14px;
    align-items:center;
    color:#374151;
    font-weight:600;
  }
  .chip{
    padding:7px 10px;
    border-radius:999px;
    background: rgba(255,247,230,.75);
    border:1px solid rgba(243,215,166,.95);
    font-size:12px;
  }
  .content{padding:18px 22px 20px;display:grid;gap:14px}
  .msg{
    background: rgba(255,255,255,.75);
    border:1px solid rgba(243,215,166,.95);
    border-radius:16px;
    padding:14px 14px;
    line-height:1.55;
    font-size:15px;
    white-space:pre-wrap;
  }
  .photo{
    width:100%;
    max-height:260px;
    object-fit:cover;
    border-radius:16px;
    border:1px solid rgba(243,215,166,.95);
    display:${d.photoDataUrl ? "block" : "none"};
  }
  .actions{
    display:flex;flex-wrap:wrap;gap:10px;
    padding:14px 22px 22px;
    border-top:1px solid rgba(243,215,166,.9);
    justify-content:space-between;
    align-items:center;
    background: rgba(255,255,255,.72);
  }
  .btns{display:flex;flex-wrap:wrap;gap:10px}
  button,a.btn{
    appearance:none;border:none;border-radius:999px;
    padding:10px 14px;cursor:pointer;font-weight:800;
    text-decoration:none;display:inline-flex;align-items:center;gap:8px;
    box-shadow:0 10px 22px rgba(217,119,6,.16);
  }
  .primary{background: linear-gradient(180deg, #ffb85c, #ff8a00);color:#fff;}
  .secondary{background:#fff;color:#b45309;border:1px solid rgba(243,215,166,.95);box-shadow:none}
  .note{font-size:12px;color:#6b7280;font-weight:600}
  canvas#confetti{position:absolute;inset:0;width:100%;height:100%;pointer-events:none}
  .balloon{position:absolute;bottom:-80px;width:46px;height:58px;border-radius:50% 50% 45% 45%;
    background:rgba(255,138,0,.28);border:1px solid rgba(255,138,0,.25);animation:floatUp 10s linear infinite;opacity:.7}
  .balloon::after{content:"";position:absolute;left:50%;top:54px;width:2px;height:60px;background:rgba(17,24,39,.18);transform:translateX(-50%)}
  @keyframes floatUp{0%{transform:translateY(0) translateX(0)}100%{transform:translateY(-980px) translateX(-40px)}}
  @media print{body{padding:0;background:#fff}.actions{display:none}.card{box-shadow:none;border:0}}
</style>
</head>
<body>
  <div class="card" id="card">
    <canvas id="confetti"></canvas>

    ${
      d.balloons
        ? `
      <div class="balloon" style="left:8%;  animation-duration:11s; background:rgba(59,130,246,.20); border-color:rgba(59,130,246,.18)"></div>
      <div class="balloon" style="left:24%; animation-duration:9.6s; background:rgba(34,197,94,.18); border-color:rgba(34,197,94,.16)"></div>
      <div class="balloon" style="left:44%; animation-duration:10.8s;background:rgba(255,138,0,.22); border-color:rgba(255,138,0,.20)"></div>
      <div class="balloon" style="left:66%; animation-duration:9.9s; background:rgba(217,70,239,.20); border-color:rgba(217,70,239,.18)"></div>
      <div class="balloon" style="left:84%; animation-duration:11.6s;background:rgba(234,179,8,.22); border-color:rgba(234,179,8,.18)"></div>
    `
        : ""
    }

    <div class="hero">
      <div class="badge">üéâ Birthday Card</div>

      ${
        showEn
          ? `
        <div class="title">Happy Birthday</div>
        <div class="name">${nameEn}</div>
      `
          : ""
      }

      ${
        showHi
          ? `
        <div class="title" style="margin-top:${
          showEn ? "18px" : "0"
        }">‡§ú‡§®‡•ç‡§Æ‡§¶‡§ø‡§® ‡§Æ‡•Å‡§¨‡§æ‡§∞‡§ï</div>
        <div class="name" style="color:var(--accent2)">${nameHi}</div>
      `
          : ""
      }

      <div class="sub">
        ${
          showEn && ageTextEn ? `<span class="chip">üéÇ ${ageTextEn}</span>` : ""
        }
        ${
          showHi && ageTextHi ? `<span class="chip">üéÇ ${ageTextHi}</span>` : ""
        }
        ${
          showEn && dateLineEn
            ? `<span class="chip">üìÖ ${dateLineEn}</span>`
            : ""
        }
        ${
          showHi && dateLineHi
            ? `<span class="chip">üìÖ ${dateLineHi}</span>`
            : ""
        }
      </div>
    </div>

    <div class="content">
      <img class="photo" alt="Photo" src="${
        d.photoDataUrl ? escHtml(d.photoDataUrl) : ""
      }" />
      <div class="msg">${showEn ? msgEn : ""}${
          showEn && showHi && msgHi ? "\n\n" : ""
        }${showHi ? msgHi : ""}</div>
      <div class="note">
        ${showEn && fromEn ? fromEn : ""}${
          showEn && showHi && fromHi ? " &nbsp;‚Ä¢&nbsp; " : ""
        }${showHi && fromHi ? fromHi : ""}
      </div>
    </div>

    <div class="actions">
      <div class="btns">
        <button class="primary" onclick="window.print()">üñ®Ô∏è Print</button>
        <a class="btn secondary" href="${waShareLink}" target="_blank" rel="noopener">üí¨ WhatsApp</a>
        ${
          d.music
            ? `<button class="secondary" id="musicBtn" type="button">üéµ Play Music</button>`
            : ""
        }
      </div>
      <div class="note">Tip: Use Print ‚Üí ‚ÄúSave as PDF‚Äù to share beautifully.</div>
    </div>
  </div>

<script>
  ${
    d.music
      ? `
  (function(){
    const btn = document.getElementById('musicBtn');
    if(!btn) return;
    const url = "https://cdn.pixabay.com/download/audio/2022/03/15/audio_4a6c5d4e38.mp3?filename=happy-birthday-115150.mp3";
    const audio = new Audio(url);
    audio.preload = "none";
    let playing = false;
    btn.addEventListener('click', async ()=>{
      try{
        if(!playing){
          await audio.play();
          playing = true;
          btn.textContent = "‚è∏Ô∏è Pause Music";
        }else{
          audio.pause();
          playing = false;
          btn.textContent = "üéµ Play Music";
        }
      }catch(e){
        alert("Music couldn't start (browser blocked it). Try clicking again.");
      }
    });
    audio.addEventListener('ended', ()=>{
      playing = false;
      btn.textContent = "üéµ Play Music";
    });
  })();
  `
      : ""
  }

  ${
    d.confettiOn
      ? `
  (function(){
    const canvas = document.getElementById('confetti');
    const card = document.getElementById('card');
    if(!canvas || !card) return;
    const ctx = canvas.getContext('2d');
    const DPR = Math.max(1, window.devicePixelRatio || 1);

    function resize(){
      const r = card.getBoundingClientRect();
      canvas.width = Math.floor(r.width * DPR);
      canvas.height = Math.floor(r.height * DPR);
      canvas.style.width = r.width + "px";
      canvas.style.height = r.height + "px";
      ctx.setTransform(DPR,0,0,DPR,0,0);
    }
    window.addEventListener('resize', resize, { passive:true });
    resize();

    const COUNT = ${conf.count};
    const SPEED = ${conf.speed};
    const pieces = Array.from({length: COUNT}, ()=>({
      x: Math.random() * card.clientWidth,
      y: -Math.random() * card.clientHeight,
      r: 3 + Math.random()*4,
      vx: (-0.5 + Math.random()) * 1.2,
      vy: (1.0 + Math.random()*2.2) * SPEED,
      a: Math.random()*Math.PI*2,
      va: (-0.06 + Math.random()*0.12)
    }));

    function draw(){
      ctx.clearRect(0,0,card.clientWidth,card.clientHeight);
      for(const p of pieces){
        p.x += p.vx; p.y += p.vy; p.a += p.va;
        if(p.y > card.clientHeight + 20){ p.y = -20; p.x = Math.random()*card.clientWidth; }
        if(p.x < -20) p.x = card.clientWidth + 20;
        if(p.x > card.clientWidth + 20) p.x = -20;

        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.a);
        const g = Math.floor(40 + Math.random()*180);
        ctx.fillStyle = "rgba(" + g + "," + g + "," + g + ",0.20)";
        ctx.fillRect(-p.r, -p.r/2, p.r*2, p.r);
        ctx.restore();
      }
      requestAnimationFrame(draw);
    }
    draw();
  })();
  `
      : ""
  }
<\/script>
</body>
</html>`;
      }

      function updateModeLabel(d) {
        els.mode.textContent = `mode: ${d.langMode} ‚Ä¢ tpl: ${d.tpl}`;
      }

      function refreshPreview() {
        try {
          const d = getData();
          updateModeLabel(d);
          setSelectedThumb(d.tpl);
          els.pv.srcdoc = buildCardHtml(d);
          setStatus("Preview updated", true);
        } catch (err) {
          console.error(err);
          setStatus("Error building preview", false);
        }
      }

      async function copyHtml() {
        const d = getData();
        const html = buildCardHtml(d);
        try {
          await navigator.clipboard.writeText(html);
          setStatus("HTML copied", true);
        } catch {
          try {
            const ta = document.createElement("textarea");
            ta.value = html;
            document.body.appendChild(ta);
            ta.select();
            document.execCommand("copy");
            ta.remove();
            setStatus("HTML copied (fallback)", true);
          } catch {
            setStatus("Copy failed (clipboard blocked)", false);
          }
        }
      }

      function downloadHtml() {
        const d = getData();
        const html = buildCardHtml(d);
        const safeName = (d.name || "birthday-card")
          .toLowerCase()
          .replace(/[^a-z0-9]+/g, "-")
          .replace(/^-+|-+$/g, "");
        const filename = `${safeName || "birthday-card"}.html`;
        const blob = new Blob([html], { type: "text/html;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
        setStatus("Downloaded", true);
      }

      function resetAll() {
        els.langMode.value = "en";
        els.tpl.value = "pastel";
        els.name.value = "Aarav";
        els.age.value = "10";
        els.date.value = "23 Jan 2026";
        els.from.value = "Champak Roy";
        els.msg.value =
          "Wishing you a day filled with happiness, laughter, and lots of cake! üéÇ";
        els.waPhone.value = "";
        els.confetti.value = "med";
        els.tBalloons.checked = true;
        els.tConfetti.checked = true;
        els.tMusic.checked = true;
        els.photo.value = "";
        photoDataUrl = "";
        setSelectedThumb("pastel");
        setStatus("Reset done", true);
        refreshPreview();
      }

      function wireThumbs() {
        els.thumbs.addEventListener("click", (e) => {
          const t = e.target.closest(".thumb");
          if (!t) return;
          els.tpl.value = t.dataset.tpl;
          setSelectedThumb(els.tpl.value);
          refreshPreview();
        });
        els.thumbs.addEventListener("keydown", (e) => {
          if (e.key !== "Enter" && e.key !== " ") return;
          const t = e.target.closest(".thumb");
          if (!t) return;
          e.preventDefault();
          els.tpl.value = t.dataset.tpl;
          setSelectedThumb(els.tpl.value);
          refreshPreview();
        });
      }

      function wirePhoto() {
        els.photo.addEventListener("change", () => {
          const file = els.photo.files && els.photo.files[0];
          if (!file) {
            photoDataUrl = "";
            refreshPreview();
            return;
          }
          if (!file.type.startsWith("image/")) {
            setStatus("Please choose an image file", false);
            els.photo.value = "";
            photoDataUrl = "";
            refreshPreview();
            return;
          }
          const reader = new FileReader();
          reader.onload = () => {
            photoDataUrl = String(reader.result || "");
            setStatus("Photo added", true);
            refreshPreview();
          };
          reader.onerror = () => setStatus("Could not read image", false);
          reader.readAsDataURL(file);
        });
      }

      let debounceT = 0;
      function debouncedRefresh() {
        clearTimeout(debounceT);
        debounceT = setTimeout(refreshPreview, 160);
      }

      function wireForm() {
        els.form.addEventListener("input", debouncedRefresh);
        els.form.addEventListener("change", debouncedRefresh);
        els.tpl.addEventListener("change", () => {
          setSelectedThumb(els.tpl.value);
          refreshPreview();
        });
      }

      els.btnRefresh.addEventListener("click", refreshPreview);
      els.btnCopy.addEventListener("click", copyHtml);
      els.btnDownload.addEventListener("click", downloadHtml);
      els.btnReset.addEventListener("click", resetAll);

      wireThumbs();
      wirePhoto();
      wireForm();
      refreshPreview();
    </script>
  </body>
</html>
