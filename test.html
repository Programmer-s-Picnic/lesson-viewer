<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Programmer's Picnic – Visualizer Template</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --pp-vis-bg-body: #fff7e6;
      --pp-vis-bg-panel: #fffaf0;
      --pp-vis-bg-card: #fffaf0;
      --pp-vis-text-main: #3a2a1a;
      --pp-vis-accent-strong: #b35a00;
      --pp-vis-accent-med: #a14c00;
      --pp-vis-accent-soft: #8c3f00;
      --pp-vis-border-soft: #f3c26b;

      --pp-vis-cell-bg: #fff8e1;
      --pp-vis-cell-border: #f3c26b;
      --pp-vis-cell-active: #ffcc80;
      --pp-vis-cell-compare: #ffe0b2;
      --pp-vis-cell-found: #c8e6c9;
      --pp-vis-cell-miss: #ffcdd2;

      --pp-vis-pointer-current: #fb923c;
      --pp-vis-pointer-low: #22c55e;
      --pp-vis-pointer-mid: #3b82f6;
      --pp-vis-pointer-high: #eab308;

      --pp-vis-code-bg: #fff3d1;
      --pp-vis-code-border: #f1b14b;

      --pp-vis-log-bg: #fff8dd;
      --pp-vis-log-border: #f3c26b;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--pp-vis-bg-body);
      color: var(--pp-vis-text-main);
    }

    .pp-vis-root {
      max-width: 1100px;
      margin: 16px auto;
      padding: 16px;
      background: var(--pp-vis-bg-panel);
      border-radius: 16px;
      border: 1px solid var(--pp-vis-border-soft);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .pp-vis-header {
      margin-bottom: 12px;
    }

    .pp-vis-title {
      margin: 0 0 4px 0;
      font-size: 1.4rem;
      color: var(--pp-vis-accent-strong);
    }

    .pp-vis-subtitle {
      margin: 0;
      font-size: 0.9rem;
      color: var(--pp-vis-accent-soft);
      opacity: 0.9;
    }

    .pp-vis-main {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 12px;
      margin-top: 12px;
    }

    @media (max-width: 900px) {
      .pp-vis-main {
        grid-template-columns: 1fr;
      }
    }

    .pp-vis-panel {
      background: var(--pp-vis-bg-card);
      border-radius: 12px;
      border: 1px solid var(--pp-vis-border-soft);
      padding: 10px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.04);
    }

    .pp-vis-panel-title {
      margin: 0 0 8px 0;
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--pp-vis-accent-med);
    }

    /* ARRAY / STRUCTURE PANEL */
    .pp-vis-structure {
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: stretch;
      justify-content: center;
    }

    .pp-vis-array-row {
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .pp-vis-array-cell {
      min-width: 48px;
      height: 56px;
      padding: 4px 6px;
      border-radius: 10px;
      border: 2px solid var(--pp-vis-cell-border);
      background: var(--pp-vis-cell-bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 0.95rem;
      position: relative;
      transition:
        background 0.18s ease,
        transform 0.18s ease,
        border-color 0.18s ease,
        box-shadow 0.18s ease;
    }

    .pp-vis-array-cell.pp-vis-cell-active {
      background: var(--pp-vis-cell-active);
      border-color: #fb923c;
      box-shadow: 0 0 0 2px rgba(251, 146, 60, 0.35);
      transform: translateY(-2px);
    }

    .pp-vis-array-cell.pp-vis-cell-compare {
      background: var(--pp-vis-cell-compare);
      border-color: #f59e0b;
    }

    .pp-vis-array-cell.pp-vis-cell-found {
      background: var(--pp-vis-cell-found);
      border-color: #22c55e;
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.4);
    }

    .pp-vis-array-cell.pp-vis-cell-miss {
      background: var(--pp-vis-cell-miss);
      border-color: #ef4444;
    }

    .pp-vis-array-value {
      font-weight: 600;
    }

    .pp-vis-array-index {
      font-size: 0.7rem;
      opacity: 0.8;
      margin-top: 2px;
    }

    /* POINTERS UNDER CELL */
    .pp-vis-pointer-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 2px;
      position: absolute;
      bottom: -18px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.6rem;
    }

    .pp-vis-pointer-badge {
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid rgba(0, 0, 0, 0.06);
      background: rgba(255, 255, 255, 0.9);
      white-space: nowrap;
    }

    .pp-vis-pointer-current {
      background: var(--pp-vis-pointer-current);
      color: #1f2937;
    }

    .pp-vis-pointer-low {
      background: var(--pp-vis-pointer-low);
      color: #052e16;
    }

    .pp-vis-pointer-mid {
      background: var(--pp-vis-pointer-mid);
      color: #eff6ff;
    }

    .pp-vis-pointer-high {
      background: var(--pp-vis-pointer-high);
      color: #422006;
    }

    /* LOG PANEL */
    .pp-vis-log {
      background: var(--pp-vis-log-bg);
      border-radius: 10px;
      border: 1px dashed var(--pp-vis-log-border);
      padding: 8px;
      font-size: 0.85rem;
      min-height: 60px;
      white-space: pre-wrap;
    }

    .pp-vis-log-label {
      font-weight: 600;
      color: var(--pp-vis-accent-soft);
    }

    /* CODE PANEL */
    .pp-vis-code-wrapper {
      background: var(--pp-vis-code-bg);
      border-radius: 10px;
      border: 1px solid var(--pp-vis-code-border);
      padding: 8px;
      max-height: 260px;
      overflow: auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
        "Courier New", monospace;
      font-size: 0.8rem;
      position: relative;
    }

    .pp-vis-code-line {
      padding: 1px 4px;
      border-radius: 6px;
      transition: background 0.18s ease, color 0.18s ease;
      display: block;
    }

    .pp-vis-code-line span {
      opacity: 0.85;
    }

    .pp-vis-code-line-active {
      background: #fed7aa;
      color: #7c2d12;
    }

    .pp-vis-code-line-dim {
      opacity: 0.6;
    }

    /* CONTROLS */
    .pp-vis-controls {
      margin-top: 14px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      justify-content: space-between;
    }

    .pp-vis-controls-left {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .pp-vis-btn {
      border-radius: 999px;
      border: 1px solid #b57400;
      background: #ffcc73;
      padding: 6px 12px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .pp-vis-btn:hover {
      background: #ffdb9b;
    }

    .pp-vis-btn:disabled {
      opacity: 0.5;
      cursor: default;
      background: #ffe8b5;
    }

    .pp-vis-badge-small {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--pp-vis-border-soft);
      background: #fff7e6;
      font-size: 0.75rem;
    }

    .pp-vis-speed-control {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 0.75rem;
    }

    .pp-vis-speed-control input {
      width: 90px;
    }

    .pp-vis-footer-note {
      margin-top: 8px;
      font-size: 0.75rem;
      opacity: 0.8;
      text-align: right;
    }
  </style>
</head>
<body>

  <div class="pp-vis-root">
    <div class="pp-vis-header">
      <h1 class="pp-vis-title" id="pp-vis-title">Programmer's Picnic Visualizer</h1>
      <p class="pp-vis-subtitle" id="pp-vis-subtitle">
        A reusable template for arrays / searching / algorithm visualizations.
      </p>
    </div>

    <div class="pp-vis-main">
      <!-- Left: Data structure / animation -->
      <section class="pp-vis-panel">
        <h2 class="pp-vis-panel-title">Structure</h2>
        <div class="pp-vis-structure">
          <div class="pp-vis-array-row" id="pp-vis-array-row"></div>
          <div class="pp-vis-log" id="pp-vis-log">
            <span class="pp-vis-log-label">Step log will appear here...</span>
          </div>
        </div>
      </section>

      <!-- Right: Code + info -->
      <section class="pp-vis-panel">
        <h2 class="pp-vis-panel-title">Code (with highlighted step)</h2>
        <div class="pp-vis-code-wrapper" id="pp-vis-code"></div>
      </section>
    </div>

    <!-- Controls -->
    <div class="pp-vis-controls">
      <div class="pp-vis-controls-left">
        <button class="pp-vis-btn" id="pp-vis-btn-prev">⬅ Prev</button>
        <button class="pp-vis-btn" id="pp-vis-btn-play">▶ Auto Play</button>
        <button class="pp-vis-btn" id="pp-vis-btn-next">Next ➡</button>
        <button class="pp-vis-btn" id="pp-vis-btn-reset">⟲ Reset</button>
      </div>

      <div class="pp-vis-speed-control">
        <span>Speed:</span>
        <input type="range" id="pp-vis-speed" min="400" max="2000" value="900" step="100" />
        <span id="pp-vis-speed-label">0.9s</span>
      </div>

      <div class="pp-vis-badge-small" id="pp-vis-step-indicator">
        Step 0 / 0
      </div>
    </div>

    <div class="pp-vis-footer-note">
      Visual engine by Programmer's Picnic • Ready for Arrays / Linear Search / Binary Search.
    </div>
  </div>

  <script>
    // -------------------------------
    //  PP Visualizer Engine
    // -------------------------------
    (function () {
      /**
       * config = {
       *   title: string,
       *   subtitle: string,
       *   type: "array-search" | "array" | "custom",
       *   array: [...],
       *   target: number | string | null,
       *   code: string,
       *   steps: [
       *     {
       *       label: "text",
       *       description: "human-friendly explanation",
       *       activeIndex: number | null,
       *       compareIndex: number | null,
       *       foundIndex: number | null,
       *       missIndex: number | null,
       *       pointers: { low?: number, mid?: number, high?: number, current?: number, [name]: index },
       *       highlightLines: [1,2,...]
       *     }
       *   ]
       * }
       */

      function PPVisualizer(rootEl, config) {
        this.rootEl = rootEl;
        this.config = config;
        this.currentStepIndex = 0;
        this.autoTimer = null;
        this.speedMs = 900;

        // DOM references
        this.titleEl = document.getElementById("pp-vis-title");
        this.subtitleEl = document.getElementById("pp-vis-subtitle");
        this.arrayRowEl = document.getElementById("pp-vis-array-row");
        this.logEl = document.getElementById("pp-vis-log");
        this.codeEl = document.getElementById("pp-vis-code");
        this.stepIndicatorEl = document.getElementById("pp-vis-step-indicator");
        this.btnPrev = document.getElementById("pp-vis-btn-prev");
        this.btnNext = document.getElementById("pp-vis-btn-next");
        this.btnPlay = document.getElementById("pp-vis-btn-play");
        this.btnReset = document.getElementById("pp-vis-btn-reset");
        this.speedSlider = document.getElementById("pp-vis-speed");
        this.speedLabel = document.getElementById("pp-vis-speed-label");

        // Setup
        this.init();
      }

      PPVisualizer.prototype.init = function () {
        const cfg = this.config;

        // Title & subtitle
        if (cfg.title) this.titleEl.textContent = cfg.title;
        if (cfg.subtitle) this.subtitleEl.textContent = cfg.subtitle;

        // Render base array once
        this.renderArrayBase();

        // Setup code block lines
        this.renderCode(cfg.code || "");

        // Attach listeners
        this.attachEvents();

        // Render initial step
        this.renderStep();
      };

      PPVisualizer.prototype.attachEvents = function () {
        const self = this;

        this.btnPrev.addEventListener("click", function () {
          self.stopAuto();
          self.prevStep();
        });

        this.btnNext.addEventListener("click", function () {
          self.stopAuto();
          self.nextStep();
        });

        this.btnReset.addEventListener("click", function () {
          self.stopAuto();
          self.currentStepIndex = 0;
          self.renderStep();
        });

        this.btnPlay.addEventListener("click", function () {
          if (self.autoTimer) {
            self.stopAuto();
          } else {
            self.startAuto();
          }
        });

        this.speedSlider.addEventListener("input", function () {
          self.speedMs = Number(self.speedSlider.value);
          self.speedLabel.textContent = (self.speedMs / 1000).toFixed(1) + "s";
          if (self.autoTimer) {
            self.stopAuto();
            self.startAuto();
          }
        });

        // Optional: keyboard shortcuts
        document.addEventListener("keydown", function (evt) {
          if (!self.rootEl.contains(document.activeElement)) {
            // Only respond when focus is roughly on page
          }
          if (evt.key === "ArrowRight") {
            self.stopAuto();
            self.nextStep();
          } else if (evt.key === "ArrowLeft") {
            self.stopAuto();
            self.prevStep();
          } else if (evt.key === " ") {
            evt.preventDefault();
            if (self.autoTimer) {
              self.stopAuto();
            } else {
              self.startAuto();
            }
          }
        });
      };

      PPVisualizer.prototype.startAuto = function () {
        const self = this;
        if (this.autoTimer) return;
        this.btnPlay.textContent = "⏸ Pause";
        this.autoTimer = setInterval(function () {
          if (self.currentStepIndex >= self.config.steps.length - 1) {
            self.stopAuto();
            return;
          }
          self.nextStep();
        }, this.speedMs);
      };

      PPVisualizer.prototype.stopAuto = function () {
        if (this.autoTimer) {
          clearInterval(this.autoTimer);
          this.autoTimer = null;
          this.btnPlay.textContent = "▶ Auto Play";
        }
      };

      PPVisualizer.prototype.prevStep = function () {
        if (this.currentStepIndex > 0) {
          this.currentStepIndex--;
          this.renderStep();
        }
      };

      PPVisualizer.prototype.nextStep = function () {
        if (this.currentStepIndex < this.config.steps.length - 1) {
          this.currentStepIndex++;
          this.renderStep();
        }
      };

      PPVisualizer.prototype.renderArrayBase = function () {
        const arr = this.config.array || [];
        this.arrayRowEl.innerHTML = "";
        arr.forEach((value, idx) => {
          const cell = document.createElement("div");
          cell.className = "pp-vis-array-cell";
          cell.dataset.index = String(idx);

          const vEl = document.createElement("div");
          vEl.className = "pp-vis-array-value";
          vEl.textContent = String(value);

          const iEl = document.createElement("div");
          iEl.className = "pp-vis-array-index";
          iEl.textContent = "[" + idx + "]";

          const pointerWrap = document.createElement("div");
          pointerWrap.className = "pp-vis-pointer-badges";

          cell.appendChild(vEl);
          cell.appendChild(iEl);
          cell.appendChild(pointerWrap);

          this.arrayRowEl.appendChild(cell);
        });
      };

      PPVisualizer.prototype.renderCode = function (codeStr) {
        const lines = codeStr.split("\n");
        this.codeEl.innerHTML = "";
        this.codeLines = [];

        lines.forEach((line, idx) => {
          const lineNum = idx + 1;
          const div = document.createElement("div");
          div.className = "pp-vis-code-line";
          div.dataset.line = String(lineNum);

          const numSpan = document.createElement("span");
          numSpan.style.opacity = "0.45";
          numSpan.style.marginRight = "4px";
          numSpan.textContent = lineNum.toString().padStart(2, " ") + " ";

          const textSpan = document.createElement("span");
          textSpan.textContent = line || " ";

          div.appendChild(numSpan);
          div.appendChild(textSpan);

          this.codeEl.appendChild(div);
          this.codeLines.push(div);
        });
      };

      PPVisualizer.prototype.clearArrayState = function () {
        const cells = this.arrayRowEl.querySelectorAll(".pp-vis-array-cell");
        cells.forEach((cell) => {
          cell.classList.remove(
            "pp-vis-cell-active",
            "pp-vis-cell-compare",
            "pp-vis-cell-found",
            "pp-vis-cell-miss"
          );
          const badgesWrap = cell.querySelector(".pp-vis-pointer-badges");
          if (badgesWrap) badgesWrap.innerHTML = "";
        });
      };

      PPVisualizer.prototype.renderStep = function () {
        const steps = this.config.steps || [];
        if (!steps.length) {
          this.logEl.innerHTML =
            "<span class='pp-vis-log-label'>No steps defined. Add steps[] in config.</span>";
          this.stepIndicatorEl.textContent = "Step 0 / 0";
          this.btnPrev.disabled = true;
          this.btnNext.disabled = true;
          return;
        }

        // Clamp index
        if (this.currentStepIndex < 0) this.currentStepIndex = 0;
        if (this.currentStepIndex >= steps.length) this.currentStepIndex = steps.length - 1;

        const step = steps[this.currentStepIndex];

        // Step indicator
        this.stepIndicatorEl.textContent =
          "Step " + (this.currentStepIndex + 1) + " / " + steps.length;

        // Enable / disable prev/next
        this.btnPrev.disabled = this.currentStepIndex === 0;
        this.btnNext.disabled = this.currentStepIndex === steps.length - 1;

        // Log
        const label = step.label || "Step " + (this.currentStepIndex + 1);
        const desc = step.description || "";
        this.logEl.innerHTML =
          "<span class='pp-vis-log-label'>" +
          label +
          ":</span> " +
          (desc ? "<br>" + desc : "");

        // Array visuals
        this.clearArrayState();
        this.applyStepToArray(step);

        // Code highlight
        this.applyCodeHighlight(step.highlightLines || []);
      };

      PPVisualizer.prototype.applyStepToArray = function (step) {
        const cells = this.arrayRowEl.querySelectorAll(".pp-vis-array-cell");
        const getCell = (index) => cells[index] || null;

        if (typeof step.activeIndex === "number") {
          const cell = getCell(step.activeIndex);
          if (cell) cell.classList.add("pp-vis-cell-active");
        }
        if (typeof step.compareIndex === "number") {
          const cell = getCell(step.compareIndex);
          if (cell) cell.classList.add("pp-vis-cell-compare");
        }
        if (typeof step.foundIndex === "number") {
          const cell = getCell(step.foundIndex);
          if (cell) cell.classList.add("pp-vis-cell-found");
        }
        if (typeof step.missIndex === "number") {
          const cell = getCell(step.missIndex);
          if (cell) cell.classList.add("pp-vis-cell-miss");
        }

        // Pointers
        if (step.pointers) {
          Object.entries(step.pointers).forEach(([name, idx]) => {
            if (typeof idx !== "number") return;
            const cell = getCell(idx);
            if (!cell) return;
            const wrap = cell.querySelector(".pp-vis-pointer-badges");
            if (!wrap) return;

            const badge = document.createElement("div");
            badge.className = "pp-vis-pointer-badge";
            const lowerName = name.toLowerCase();

            if (lowerName === "current") {
              badge.classList.add("pp-vis-pointer-current");
              badge.textContent = "curr";
            } else if (lowerName === "low") {
              badge.classList.add("pp-vis-pointer-low");
              badge.textContent = "low";
            } else if (lowerName === "mid") {
              badge.classList.add("pp-vis-pointer-mid");
              badge.textContent = "mid";
            } else if (lowerName === "high") {
              badge.classList.add("pp-vis-pointer-high");
              badge.textContent = "high";
            } else {
              badge.textContent = name;
            }

            wrap.appendChild(badge);
          });
        }
      };

      PPVisualizer.prototype.applyCodeHighlight = function (lines) {
        const set = new Set(lines || []);
        this.codeLines.forEach((lineDiv) => {
          const ln = Number(lineDiv.dataset.line);
          lineDiv.classList.remove("pp-vis-code-line-active", "pp-vis-code-line-dim");
          if (set.size === 0) return;
          if (set.has(ln)) {
            lineDiv.classList.add("pp-vis-code-line-active");
          } else {
            lineDiv.classList.add("pp-vis-code-line-dim");
          }
        });
      };

      // Public initializer
      window.initPPVisualizer = function (config) {
        const rootEl = document.querySelector(".pp-vis-root");
        if (!rootEl) {
          console.error("PP Visualizer: .pp-vis-root not found.");
          return null;
        }
        return new PPVisualizer(rootEl, config);
      };
    })();

    // ------------------------------------------
    // DEMO CONFIG (Linear-search-style example)
    // ------------------------------------------
    const demoConfig = {
      title: "Linear Search Visualizer (Demo Template)",
      subtitle:
        "Step through how a simple linear search scans an array. This is just a demo of the engine.",
      type: "array-search",
      array: [4, 1, 9, 7, 3],
      target: 7,
      code: [
        "arr = [4, 1, 9, 7, 3]",
        "target = 7",
        "index = -1",
        "for i, value in enumerate(arr):",
        "    if value == target:",
        "        index = i",
        "        break",
        "print(index)"
      ].join("\n"),
      steps: [
        {
          label: "Start",
          description:
            "We begin linear search at index 0. index = -1 (not yet found).",
          activeIndex: 0,
          pointers: { current: 0 },
          highlightLines: [1, 2, 3]
        },
        {
          label: "Compare arr[0]",
          description:
            "Compare arr[0] = 4 with target = 7. Not equal, move to next index.",
          activeIndex: 0,
          compareIndex: 0,
          missIndex: 0,
          pointers: { current: 0 },
          highlightLines: [4]
        },
        {
          label: "Move to index 1",
          description:
            "i is incremented to 1. Now we compare arr[1] with the target.",
          activeIndex: 1,
          pointers: { current: 1 },
          highlightLines: [4]
        },
        {
          label: "Compare arr[1]",
          description:
            "arr[1] = 1, still not equal to 7. Keep scanning linearly.",
          activeIndex: 1,
          compareIndex: 1,
          missIndex: 1,
          pointers: { current: 1 },
          highlightLines: [4]
        },
        {
          label: "Move to index 2",
          description: "Now we are at index 2. Next comparison incoming.",
          activeIndex: 2,
          pointers: { current: 2 },
          highlightLines: [4]
        },
        {
          label: "Compare arr[2]",
          description:
            "arr[2] = 9, which is not equal to 7. Continue to next index.",
          activeIndex: 2,
          compareIndex: 2,
          missIndex: 2,
          pointers: { current: 2 },
          highlightLines: [4]
        },
        {
          label: "Move to index 3",
          description:
            "Now i = 3. We are about to compare arr[3] with the target.",
          activeIndex: 3,
          pointers: { current: 3 },
          highlightLines: [4]
        },
        {
          label: "Found at index 3",
          description:
            "arr[3] = 7 which matches the target. We set index = 3 and break the loop.",
          activeIndex: 3,
          compareIndex: 3,
          foundIndex: 3,
          pointers: { current: 3 },
          highlightLines: [4, 5, 6]
        },
        {
          label: "Print result",
          description:
            "Loop ends. index = 3, so the program prints 3 as the position of the target.",
          activeIndex: 3,
          foundIndex: 3,
          highlightLines: [7, 8]
        }
      ]
    };

    // Init when DOM is ready
    document.addEventListener("DOMContentLoaded", function () {
      initPPVisualizer(demoConfig);
    });
  </script>
</body>
</html>
